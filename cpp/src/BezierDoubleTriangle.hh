#ifndef CPP_BEZIER_DOUBLE_TRIANGLE_HH
#define CPP_BEZIER_DOUBLE_TRIANGLE_HH

#include "utils.hh"

#include <Eigen/Core>

namespace pev
{
template <typename T, typename C = double>
class BezierDoubleTriangle
{
public:
    using Self = BezierDoubleTriangle;
    using Coeffs = Eigen::Matrix<T, 18, 1>;
    using Coords = Eigen::Matrix<C, 6, 1>;

    enum Indices : int
    {
        i100200 = 0,
        i010200,
        i001200,
        i100020,
        i010020,
        i001020,
        i100002,
        i010002,
        i001002,
        i100110,
        i010110,
        i001110,
        i100011,
        i010011,
        i001011,
        i100101,
        i010101,
        i001101
    };

    BezierDoubleTriangle()
    {
    }

    explicit BezierDoubleTriangle(const Coeffs& coefficients)
            : _coeffs(coefficients)
    {
    }

    T operator()(const Coords& pos) const
    {
        return makeBasis(pos).dot(_coeffs);
    }

    C& operator[](int i)
    {
        return _coeffs[i];
    }

    const C& operator[](int i) const
    {
        return _coeffs[i];
    }

    Coeffs& coefficients()
    {
        return _coeffs;
    }

    const Coeffs& coefficients() const
    {
        return _coeffs;
    }

    std::array<Self, 16> split() const
    {
        return {Self{m0_() * m_0() * _coeffs},
                Self{m0_() * m_1() * _coeffs},
                Self{m0_() * m_2() * _coeffs},
                Self{m0_() * m_3() * _coeffs},
                Self{m1_() * m_0() * _coeffs},
                Self{m1_() * m_1() * _coeffs},
                Self{m1_() * m_2() * _coeffs},
                Self{m1_() * m_3() * _coeffs},
                Self{m2_() * m_0() * _coeffs},
                Self{m2_() * m_1() * _coeffs},
                Self{m2_() * m_2() * _coeffs},
                Self{m2_() * m_3() * _coeffs},
                Self{m3_() * m_0() * _coeffs},
                Self{m3_() * m_1() * _coeffs},
                Self{m3_() * m_2() * _coeffs},
                Self{m3_() * m_3() * _coeffs}};
    }

    std::array<Self, 4> split_pos() const
    {
        return {Self{m0_() * _coeffs},
                Self{m1_() * _coeffs},
                Self{m2_() * _coeffs},
                Self{m3_() * _coeffs}};
    }

    std::array<Self, 4> split_dir() const
    {
        return {Self{m_0() * _coeffs},
                Self{m_1() * _coeffs},
                Self{m_2() * _coeffs},
                Self{m_3() * _coeffs}};
    }


private:
    using Matrix18 = Eigen::Matrix<T, 18, 18>;
    using Basis = Eigen::Matrix<C, 18, 1>;

    // Coefficients of the Bezier Triangle
    Coeffs _coeffs;

    static Basis makeBasis(const Coords& pos)
    {
        return (Basis{} <<
                1 * pos[0] * pos[3] * pos[3],
                1 * pos[1] * pos[3] * pos[3],
                1 * pos[2] * pos[3] * pos[3],
                1 * pos[0] * pos[4] * pos[4],
                1 * pos[1] * pos[4] * pos[4],
                1 * pos[2] * pos[4] * pos[4],
                1 * pos[0] * pos[5] * pos[5],
                1 * pos[1] * pos[5] * pos[5],
                1 * pos[2] * pos[5] * pos[5],
                2 * pos[0] * pos[3] * pos[4],
                2 * pos[1] * pos[3] * pos[4],
                2 * pos[2] * pos[3] * pos[4],
                2 * pos[0] * pos[4] * pos[5],
                2 * pos[1] * pos[4] * pos[5],
                2 * pos[2] * pos[4] * pos[5],
                2 * pos[0] * pos[3] * pos[5],
                2 * pos[1] * pos[3] * pos[5],
                2 * pos[2] * pos[3] * pos[5])
                .finished();
    }

    // Splitting operator matrices

    static Matrix18 m0_()
    {
        static Matrix18 result = (Matrix18{} <<
                1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2

        ).finished();
        return result;
    };

    static Matrix18 m1_()
    {
        static Matrix18 result = (Matrix18{} <<
                1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2

        ).finished();
        return result;
    };

    static Matrix18 m2_()
    {
        static Matrix18 result = (Matrix18{} <<
                1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1

        ).finished();
        return result;
    };

    static Matrix18 m3_()
    {
        static Matrix18 result = (Matrix18{} <<
                  0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0., 1./2,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2, 1./2,   0.

        ).finished();
        return result;
    };

    static Matrix18 m_0()
    {
        static Matrix18 result = (Matrix18{} <<
                1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,
                  0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,
                  0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,
                1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,
                  0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,
                  0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,
                1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,
                  0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,
                  0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2
        ).finished();
        return result;
    };

    static Matrix18 m_1()
    {
        static Matrix18 result = (Matrix18{} <<
                1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,
                  0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,
                  0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,
                  0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,
                  0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4
        ).finished();
        return result;
    };

    static Matrix18 m_2()
    {
        static Matrix18 result = (Matrix18{} <<
                1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,
                  0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,
                  0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,
                  0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./1,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,
                  0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2
        ).finished();
        return result;
    };

    static Matrix18 m_3()
    {
        static Matrix18 result = (Matrix18{} <<
                  0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,
                1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,
                  0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,   0.,
                  0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./2,
                1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./2,   0.,   0.,   0.,   0.,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,
                  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,
                1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,
                  0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,
                  0.,   0., 1./4,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,
                  0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0.,
                  0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4,   0.,
                  0.,   0.,   0.,   0.,   0., 1./4,   0.,   0.,   0.,   0.,   0., 1./4,   0.,   0., 1./4,   0.,   0., 1./4
        ).finished();
        return result;
    };

};

} // namespace pev

#endif
